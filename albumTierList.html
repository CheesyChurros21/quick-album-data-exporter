<!DOCTYPE html>

<html>
    <head>
        <link rel='stylesheet' href='albumDisplayer.css'>

        <title>
            Album Displayer
        </title>

        <header class='websiteTitle' id="sortOption">
            Album Database Browser
        </header>
    </head>

    <body>
        <div id="albumContainer" class="albumGrid">

        </div>
        
    </body>


    <script>
    
        let circleAlbums = [];
        let filteredAlbums = [];
       
        let parameters = new URLSearchParams(window.location.search);
        let selectedOptions = parameters.get("orderOptionsTierList") + " " + parameters.get("whoOptionsTierList") + " " + parameters.get("rankTypeTierList");

        let albumContainer = document.getElementById("albumContainer");

        fetch('all_albums.json')
        .then(response => response.json())
        .then(data => {

            if (selectedOptions == "Descending Jordan Objective") {
                filteredAlbums = data.filter(entry => ratingRange[0] <= entry.objectiveJordan && entry.objectiveJordan <= ratingRange[1]);
                circleAlbums = filteredAlbums.sort((a, b) => b.objectiveJordan - a.objectiveJordan);
            }

            else if (selectedOptions == "Descending Nick Objective") {
                filteredAlbums = data.filter(entry => ratingRange[0] <= entry.objectiveNick && entry.objectiveNick <= ratingRange[1]);
                circleAlbums = filteredAlbums.sort((a, b) => b.objectiveNick - a.objectiveNick);
            }

            else if (selectedOptions == "Descending Jordan Subjective") {
                filteredAlbums = data.filter(entry => ratingRange[0] <= entry.subjectiveJordan && entry.subjectiveJordan <= ratingRange[1]);
                circleAlbums = filteredAlbums.sort((a, b) => b.subjectiveJordan - a.subjectiveJordan);
            }

            else if (selectedOptions == "Descending Nick Subjective") {
                filteredAlbums = data.filter(entry => ratingRange[0] <= entry.subjectiveNick && entry.subjectiveNick <= ratingRange[1]);
                circleAlbums = filteredAlbums.sort((a, b) => b.subjectiveNick - a.subjectiveNick);
            }

            else if (selectedOptions == "Ascending Jordan Objective") {
                filteredAlbums = data.filter(entry => ratingRange[0] <= entry.objectiveNick && entry.objectiveNick <= ratingRange[1]);
                circleAlbums = filteredAlbums.sort((a, b) => a.objectiveJordan - b.objectiveJordan);
            }

            else if (selectedOptions == "Ascending Nick Objective") {
                filteredAlbums = data.filter(entry => ratingRange[0] <= entry.objectiveNick && entry.objectiveNick <= ratingRange[1]);
                circleAlbums = filteredAlbums.sort((a, b) => a.objectiveNick - b.objectiveNick);
            }

            else if (selectedOptions == "Ascending Jordan Subjective") {
                filteredAlbums = data.filter(entry => ratingRange[0] <= entry.subjectiveJordan && entry.subjectiveJordan <= ratingRange[1]);
                circleAlbums = filteredAlbums.sort((a, b) => a.subjectiveJordan - b.subjectiveJordan);
            }

            else if (selectedOptions == "Ascending Nick Subjective") {
                filteredAlbums = data.filter(entry => ratingRange[0] <= entry.subjectiveNick && entry.subjectiveNick <= ratingRange[1]);
                circleAlbums = filteredAlbums.sort((a, b) => a.subjectiveNick - b.subjectiveNick);
            }

            else if (selectedOptions == "Descending Combined Objective") {
                filteredAlbums = data.filter(entry => ratingRange[0] <= entry.objectiveCombined && entry.objectiveCombined <= ratingRange[1]);
                circleAlbums = filteredAlbums.sort((a, b) => b.objectiveCombined - a.objectiveCombined);
            }

            else if (selectedOptions == "Descending Combined Subjective") {
                filteredAlbums = data.filter(entry => ratingRange[0] <= entry.subjectiveCombined && entry.subjectiveCombined <= ratingRange[1]);
                circleAlbums = filteredAlbums.sort((a, b) => b.subjectiveCombined - a.subjectiveCombined);
            }
            
            else if (selectedOptions == "Ascending Combined Objective") {
                filteredAlbums = data.filter(entry => ratingRange[0] <= entry.objectiveCombined && entry.objectiveCombined <= ratingRange[1]);
                circleAlbums = filteredAlbums.sort((a, b) => a.objectiveCombined - b.objectiveCombined);
            }

            else if (selectedOptions == "Ascending Combined Subjective") {
                filteredAlbums = data.filter(entry => ratingRange[0] <= entry.subjectiveCombined && entry.subjectiveCombined <= ratingRange[1]);
                circleAlbums = filteredAlbums.sort((a, b) => a.subjectiveCombined - b.subjectiveCombined);
            }
            
            let pageHeader = document.getElementById("sortOption");
            pageHeader.innerHTML = selectedOptions;

            if (ratingRange[0] != 0 || ratingRange[1] != 10) {
                pageHeader.innerHTML = pageHeader.innerHTML + `<br>Between ${ratingRange[0]} and ${ratingRange[1]}`;
            }

            for (let i = 0; i < circleAlbums.length; i = i + 1) {
                let album = document.createElement("div");
                album.style.textAlign = "center"; 

                album.innerHTML = `
                    <img src="${circleAlbums[i].albumPhoto}"<br><br>
                    <strong>${circleAlbums[i].albumTitle}</strong><br>
                    <strong>${circleAlbums[i].circleName}</strong><br>
                    Subjective Jordan Rating - ${circleAlbums[i].subjectiveJordan}/10<br>
                    Subjective Nick Rating - ${circleAlbums[i].subjectiveNick}/10<br><br>
                    Objective Jordan Rating - ${circleAlbums[i].objectiveJordan}/10<br>
                    Objective Nick Rating - ${circleAlbums[i].objectiveNick}/10<br><br>
                    Combined Objective Rating - ${circleAlbums[i].objectiveCombined}/10<br>
                    Combined Subjective Rating - ${circleAlbums[i].subjectiveCombined}/10<br><br>
                    Number Of Songs - ${circleAlbums[i].songAmount}<br>
                `;
                
                albumContainer.appendChild(album);

                let toggleSongRatings = document.createElement("button");
                toggleSongRatings.textContent = "Show Song Ratings";
                toggleSongRatings.onclick = () => {
                    ratingTable.style.display = ratingTable.style.display === "none" ? "block" : "none";
                }

                album.appendChild(document.createElement("br"));
                album.appendChild(toggleSongRatings);

                const ratingTable = document.createElement("table");
                ratingTable.style.display = "none"; // hidden by default
                
                ratingTable.style.borderCollapse = "collapse";
                ratingTable.innerHTML = `
                <tr>
                    <th>Song #</th>
                    <th>Song Name</th>
                    <th>Jordan Rating</th>
                    <th>Nick Rating</th>
                </tr>
                `;

                for (let ii = 0; ii < circleAlbums[i].ratings.length; ii = ii + 1) {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td>${circleAlbums[i].ratings[ii].songNumber}</td>
                    <td>${circleAlbums[i].ratings[ii].songName}</td>
                    <td>${circleAlbums[i].ratings[ii].jordanRating}</td>
                    <td>${circleAlbums[i].ratings[ii].nickRating}</td>
                `;
                    ratingTable.appendChild(row);
                }

                album.appendChild(ratingTable);
            }
        })
        .catch(error => console.error('Error loading JSON:', error));
    </script>
</html>

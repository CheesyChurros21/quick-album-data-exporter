<!DOCTYPE html>

<html>
    <head>
        <link rel='stylesheet' href='albumDisplayer.css'>

        <title>
            Album Displayer
        </title>

        <header class='websiteTitle' id="sortOption">
            Album Database Browser
        </header>
    </head>

    <body>
        <div id="albumContainer" class="tierList">

        </div>
        
    </body>


    <script>
    
        let tieredAlbums = [[], [], [], [], [], [], [], [], []];
        const tierBoundaries = [9.75, 9.5, 9, 8.5, 8, 7, 6, 5, 0];
        const tierGrades = ["SSS", "SS", "S", "A", "B", "C", "D", "E", "F"];
        const filterOptions = {
            "Jordan Objective": "objectiveJordan",
            "Nick Objective": "objectiveNick",
            "Combined Objective" : "objectiveCombined",
            "Jordan Subjective": "subjectiveJordan",
            "Nick Subjective" : "subjectiveNick",
            "Combined Subjective" : "subjectiveCombined"
        }

        function getTierIndex(rating) {
            for (let i = 0; i < tierBoundaries.length; i = i + 1) {
                if (rating >= tierBoundaries[i]) {
                    return i;
                }
            }

            return tierBoundaries.length;
        }

        
        function sortAndTier(data, key) {
            tieredAlbums = [[], [], [], [], [], [], [], [], []];
            const descendingRanks = [...data].sort((a, b) => b[key] - a[key]);

            console.log(descendingRanks);

            let tierIndex = 0;

            for (let i = 0; i < descendingRanks.length; i++) {
                const rating = descendingRanks[i][key];

                // If rating is too low for current tier, move to next tier
                while (tierIndex < tierBoundaries.length && rating < tierBoundaries[tierIndex]) {
                    tierIndex++;
                }

                // Only push if within tier range
                if (tierIndex < tieredAlbums.length) {
                    tieredAlbums[tierIndex].push(descendingRanks[i]);
                }
            }
        }
       
        let parameters = new URLSearchParams(window.location.search);
        let selectedOptions = parameters.get("whoOptionsTierList") + " " + parameters.get("rankTypeTierList");

        let albumContainer = document.getElementById("albumContainer");

        fetch('all_albums.json')
        .then(response => response.json())
        .then(data => {

            sortAndTier(data, filterOptions[selectedOptions]);

            console.log(tieredAlbums);
            
            let pageHeader = document.getElementById("sortOption");
            pageHeader.innerHTML = selectedOptions + " Rankings Tierlist";

            const albumContainer = document.getElementById("albumContainer");

            for (let i = 0; i < tieredAlbums.length; i = i + 1) {
                const tierRow = document.createElement("div");
                tierRow.className = "tierRow";

                const tierLevel = document.createElement("div");
                tierLevel.className = "tierLabel";
                tierLevel.innerText = tierGrades[i];
                
                const grid = document.createElement("div");
                grid.className = "tierGrid";

                for (let x = 0; x < tieredAlbums[i].length; x = x + 1) {
                    const album = document.createElement("div");
                    album.className = "albumCard";

                    const albumImage = document.createElement("img");
                    albumImage.src = tieredAlbums[i][x].albumPhoto;

                    album.appendChild(albumImage);
                    grid.appendChild(album);
                }

                tierRow.appendChild(tierLevel);
                tierRow.appendChild(grid);
                albumContainer.appendChild(tierRow);
            }
        })
        .catch(error => console.error('Error loading JSON:', error));
    </script>
</html>

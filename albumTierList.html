<!DOCTYPE html>

<html>
    <head>
        <link rel='stylesheet' href='albumDisplayer.css'>

        <title>
            Album Displayer
        </title>

        <header class='websiteTitle' id="sortOption">
            Album Database Browser
        </header>
    </head>

    <body>
        <div id="albumContainer" class="tierList">

        </div>
        
    </body>


    <script>
    
        let tieredAlbums = [[], [], [], [], [], [], [], [], []];
        const tierBoundaries = [9.75, 9.5, 9, 8.5, 8, 7, 6, 5, 0];
        const tierGrades = ["SSS", "SS", "S", "A", "B", "C", "D", "E", "F"];
        const filterOptions = {
            "Jordan Objective": "objectiveJordan",
            "Nick Objective": "objectiveNick",
            "Combined Objective" : "objectiveCombined",
            "Jordan Subjective": "subjectiveJordan",
            "Nick Subjective" : "subjectiveNick",
            "Combined Subjective" : "subjectiveCombined"
        }

        function getTierIndex(rating) {
            for (let i = 0; i < tierBoundaries.length; i = i + 1) {
                if (rating >= tierBoundaries[i]) {
                    return i;
                }
            }

            return tierBoundaries.length;
        }

        
        function sortAndTier(data, key) {
            tieredAlbums = [[], [], [], [], [], [], [], [], []];
            const descendingRanks = [...data].sort((a, b) => b[key] - a[key]);

            console.log(descendingRanks);

            let tierIndex = 0;

            for (let i = 0; i < descendingRanks.length; i++) {
                const rating = descendingRanks[i][key];

                // If rating is too low for current tier, move to next tier
                while (tierIndex < tierBoundaries.length && rating < tierBoundaries[tierIndex]) {
                    tierIndex++;
                }

                // Only push if within tier range
                if (tierIndex < tieredAlbums.length) {
                    tieredAlbums[tierIndex].push(descendingRanks[i]);
                }
            }
        }
       
        let parameters = new URLSearchParams(window.location.search);
        let selectedOptions = parameters.get("whoOptionsTierList") + " " + parameters.get("rankTypeTierList");
        let infoDisplayPreference = parameters.get("infoDisplayPreference");

        let albumContainer = document.getElementById("albumContainer");

        fetch('all_albums.json')
        .then(response => response.json())
        .then(data => {

            sortAndTier(data, filterOptions[selectedOptions]);

            console.log(tieredAlbums);
            
            let pageHeader = document.getElementById("sortOption");
            pageHeader.innerHTML = selectedOptions + " Rankings Tierlist";

            const albumContainer = document.getElementById("albumContainer");

            for (let i = 0; i < tieredAlbums.length; i = i + 1) {
                const tierRow = document.createElement("div");
                tierRow.className = "tierRow";

                const tierLevel = document.createElement("div");
                tierLevel.className = "tierLabel";
                tierLevel.innerText = tierGrades[i];
                
                const grid = document.createElement("div");
                grid.className = "tierGrid";

                for (let x = 0; x < tieredAlbums[i].length; x = x + 1) {
                    const album = document.createElement("div");
                    album.className = "albumCard";

                    const albumImage = document.createElement("img");
                    albumImage.src = tieredAlbums[i][x].albumPhoto;

                    const albumInfoDisplay = document.createElement("span");

                    if (infoDisplayPreference == "Hover") {
                        albumInfoDisplay.className = "albumHoverInfo";
                    }

                    else {
                        albumInfoDisplay.className = "albumClickInfo";
                    }

                    albumInfoDisplay.innerHTML = `
                        <strong>${tieredAlbums[i][x].albumTitle}</strong><br><br>
                        <strong>${tieredAlbums[i][x].circleName}</strong><br><br>
                        Subjective Jordan Rating - ${tieredAlbums[i][x].subjectiveJordan}/10<br>
                        Subjective Nick Rating - ${tieredAlbums[i][x].subjectiveNick}/10<br><br>
                        Objective Jordan Rating - ${tieredAlbums[i][x].objectiveJordan}/10<br>
                        Objective Nick Rating - ${tieredAlbums[i][x].objectiveNick}/10<br><br>
                        Combined Objective Rating - ${tieredAlbums[i][x].objectiveCombined}/10<br>
                        Combined Subjective Rating - ${tieredAlbums[i][x].subjectiveCombined}/10<br><br>
                        Number Of Songs - ${tieredAlbums[i][x].songAmount}<br>
                    `;

                    album.appendChild(albumImage);
                    album.appendChild(albumInfoDisplay);
                    grid.appendChild(album);


                }

                tierRow.appendChild(tierLevel);
                tierRow.appendChild(grid);
                albumContainer.appendChild(tierRow);
            }

            if (infoDisplayPreference == "Click") {
                document.querySelectorAll('.albumCard').forEach(card => {
                    const tooltip = card.querySelector('.albumClickInfo');

                    card.addEventListener('click', () => {
                        tooltip.style.display = (tooltip.style.display === 'block') ? 'none' : 'block';
                    });
                });
            }
        })

        .catch(error => console.error('Error loading JSON:', error));

    </script>
</html>
